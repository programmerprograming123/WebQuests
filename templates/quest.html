<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ quest.title }}</title>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: system-ui, sans-serif;
            background: #0f1220;
            color: #eaeaf0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: auto;
        }
        
        .card {
            background: #161933;
            border: 1px solid #242859;
            border-radius: 14px;
            padding: 20px;
        }
        
        h2,
        h3 {
            margin-bottom: 12px;
        }
        
        p {
            margin-bottom: 10px;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            background: #1a1d33;
            color: #eaeaf0;
            border: 1px solid #2a2f55;
            border-radius: 10px;
            padding: 10px;
        }
        
        button {
            margin-top: 10px;
            background: #7aa2ff;
            color: #0f1220;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
        }
        
        pre {
            background: #0b0e1a;
            border: 1px solid #242859;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container card">
        <h2>{{ quest.title }}</h2>
        <p>{{ quest.description }}</p>
        <p><b>Time:</b> {{ quest.time }}</p>

        <h3>Solutions</h3>

        <!-- EXISTING SOLUTIONS -->
        <div id="solutions">
            {% for s in quest.solutions %}
            <pre>{{ s.code }}</pre> {% endfor %}
        </div>

        <!-- SUBMIT -->
        <h3>Add Solution</h3>
        <form method="post">
            <textarea name="solution" required></textarea>
            <button type="submit">Submit</button>
        </form>
    </div>

    <script>
        const socket = io();
        const QUEST_ID = "{{ quest.id }}";

        socket.on("solution_added", (data) => {
            if (data.quest_id === QUEST_ID) {
                const pre = document.createElement("pre");
                pre.textContent = data.solution.code;
                document.getElementById("solutions").appendChild(pre);
            }
        });
    </script>
</body>

</html>